# A default qbicc feature that is applicable to any Quarkus application.
#
# TODO: The long list of netty and vertx reflectiveClasses suggest that
#       there is either some aspect of how GraalVM nativeimage deals with
#       reflection or some Quarkus-GraalVM configuration path we are missing.
---
runtimeResources:
  - application.properties
  - application-prod.properties
  - META-INF/microprofile-config.properties
initializeAtRuntime:
  # Quarkus
  - io.quarkus.dev.console.QuarkusConsole
  # Netty
  - io.netty.resolver.dns.DnsNameResolver
  - io.netty.resolver.dns.DefaultDnsServerAddressStreamProvider
  - io.netty.resolver.dns.DnsServerAddressStreamProviders$DefaultProviderHolder
  - io.netty.util.NetUtil
  - io.netty.handler.codec.compression.BrotliDecoder
  # JBoss
  - org.jboss.logmanager.StandardOutputStreams
  - org.jboss.logmanager.handlers.ConsoleHandler
  - org.jboss.logmanager.handlers.SyslogHandler
  - org.wildfly.common.net.HostName
  - org.wildfly.common.os.Process
  # Core JDK
  - java.net.AbstractPlainDatagramSocketImpl
  - sun.nio.ch.DatagramChannelImpl$DefaultOptionsHolder
  - sun.nio.ch.NativeSocketAddress
  - sun.nio.ch.ServerSocketChannelImpl$DefaultOptionsHolder
  - sun.nio.ch.SocketChannelImpl$DefaultOptionsHolder
reflectiveClasses:
  # TODO: see https://github.com/qbicc/quarkus-qbicc/issues/13
  # We should not need to manually discover and list all of these netty and vertx classes here!
  #
  # Netty
  - name: io.netty.bootstrap.ServerBootstrap$1
    methods: true
  - name: io.netty.bootstrap.ServerBootstrap$ServerBootstrapAcceptor
    methods: true
  - name: io.netty.channel.DefaultChannelPipeline$HeadContext
    methods: true
  - name: io.netty.channel.DefaultChannelPipeline$TailContext
    methods: true
  - name: io.netty.channel.ChannelDuplexHandler
    methods: true
  - name: io.netty.channel.ChannelHandlerAdapter
    methods: true
  - name: io.netty.channel.ChannelHandler
    methods: true
  - name: io.netty.channel.ChannelInitializer
    methods: true
  - name: io.netty.channel.ChannelInboundHandlerAdapter
    methods: true
  - name: io.netty.channel.ChannelOutboundHandlerAdapter
    methods: true
  - name: io.netty.handler.codec.ByteToMessageDecoder
    methods: true
  - name: io.netty.handler.codec.MessageToMessageEncoder
    methods: true
  - name: io.netty.handler.codec.http.HttpObjectDecoder
    methods: true
  - name: io.netty.handler.codec.http.HttpObjectEncoder
    methods: true
  - name: io.netty.handler.codec.http.HttpRequestDecoder
    methods: true
  - name: io.netty.handler.codec.http.HttpResponseEncoder
    methods: true
  - name: io.netty.handler.codec.http.websocketx.extensions.WebSocketServerExtensionHandler
    methods: true
  - name: io.netty.handler.timeout.IdleStateHandler
    methods: true
  - name: io.netty.channel.ChannelOutboundHandler
    methods: true
  # Vertx
  - name: io.vertx.core.http.impl.Http1xOrH2CHandler
    methods: true
  - name: io.vertx.core.http.impl.Http1xUpgradeToH2CHandler
    methods: true
  - name: io.vertx.core.http.impl.HttpServerWorker$1
    methods: true
  - name: io.vertx.core.net.impl.VertxHandler
    methods: true
  - name: io.vertx.core.http.impl.VertxHttpRequestDecoder
    methods: true
  - name: io.vertx.core.http.impl.VertxHttpResponseEncoder
    methods: true
  - name: io.vertx.core.net.impl.ServerChannelLoadBalancer
    methods: true
  # Core OpenJDK Classes
  - name: java.lang.Boolean
    methods: true
    fields: true
  - name: java.lang.Byte
    methods: true
    fields: true
  - name: java.lang.Character
    methods: true
    fields: true
  - name: java.lang.Comparable
    methods: true
  - name: java.lang.Double
    methods: true
    fields: true
  - name: java.lang.Float
    methods: true
    fields: true
  - name: java.lang.Integer
    methods: true
    fields: true
  - name: java.lang.Long
    methods: true
    fields: true
  - name: java.lang.Number
    methods: true
    fields: true
  - name: java.lang.Short
    methods: true
    fields: true
reflectiveConstructors:
  - declaringClass: java.io.File
    arguments:
      - java.lang.String
reflectiveFields:
  - declaringClass: java.nio.Buffer
    name: address
reflectiveMethods:
  # Quarkus
  - declaringClass: io.quarkus.runtime.logging.InheritableLevel
    name: of
    arguments:
      - java.lang.String
  # Core JDK
  - declaringClass: java.lang.management.ManagementFactory
    name: getRuntimeMXBean
  - declaringClass: java.lang.management.RuntimeMXBean
    name: getInputArguments
  - declaringClass: java.lang.ProcessHandle
    name: current
  - declaringClass: java.lang.ProcessHandle
    name: pid
  - declaringClass: sun.misc.VM
    name: maxDirectMemory
